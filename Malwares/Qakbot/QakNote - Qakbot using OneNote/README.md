![](.//media/image1.png){width="6.5926312335958in"
height="3.0717672790901136in"}![](.//media/image2.png){width="8.482639982502187in"
height="11.697916666666666in"}![](.//media/image4.png){width="0.8656660104986876in"
height="0.8571434820647419in"}![](.//media/image5.png){width="6.49375in"
height="3.0256944444444445in"}

Contents {#contents .En-ttedetabledesmatires}
========

[[Introduction]{.underline} 3](#introduction)

[[Qakbot via OneNote]{.underline} 3](#qakbot-via-onenote)

[[Conclusion]{.underline} 6](#conclusion)

[[Recommendations]{.underline} 6](#recommendations)

[[MITRE ATT&CK® Techniques]{.underline} 7](#mitre-attck-techniques)

[[IOCs]{.underline} 9](#iocs-indicator-of-compromise)

Introduction
============

The Qakbot malware has been a persistent threat to computer systems for
several years, with its ability to steal sensitive information and
compromise system security. Recently, however, researchers have
identified a new variant of Qakbot that uses the popular note-taking
application, Microsoft OneNote, to evade detection and infect users.

This new variant of Qakbot takes advantage of OneNote\'s ability to
create and run custom add-ins to launch its attack. Once installed, the
malware can steal user data, compromise system security, and even spread
to other devices on the network.

In this report, we will provide an in-depth analysis of the Qakbot
malware that uses OneNote to attack users. We will examine the
techniques and methods used by the malware to evade detection and infect
systems, as well as the impact of the attack on users and their data. We
will also explore techniques for detecting and mitigating this type of
attack and provide best practices for protecting against Qakbot and
other persistent malware threats.

By understanding the behavior and functionality of this new variant of
Qakbot, we can better protect ourselves and our organizations from the
devastating effects of malware attacks. So, let\'s dive in and explore
the world of Qakbot malware and its use of OneNote to compromise users.

Qakbot via OneNote
==================

The initial phase of infection process commences when the recipient
receives a spam email that contains a OneNote attachment.

Upon opening the attachment, an embedded BAT file is deposited and
triggered, initiating the launch of a PowerShell script.

This script subsequently downloads a Qakbot malware DLL, which is
ultimately executed through rundll32.exe.

![](.//media/image6.png){width="5.379166666666666in"
height="1.4847222222222223in"}The diagram below depicts the
OneNote-based delivery method utilized by Qakbot via PowerShell.

Qakbot malware is distributed to users through spam emails that contain
a OneNote attachment. The email subject line read for example "Success
Story, Contract Rejected, Contract Accepted".

![](.//media/image7.png){width="6.5in" height="2.361111111111111in"}

Figure 2: Email example

Once the OneNote attachment is opened by the user, a page displaying a
message is presented. The message is crafted to appear as if it contains
a cloud-based attachment, thereby tricking the user into double-clicking
on it. However, this action initiates the Qakbot infection process.

The figure below displays the OneNote page containing the fraudulent
message.

![](.//media/image8.png){width="6.5in" height="2.566666666666667in"}

Figure 3: OneNote file drops BAT file

When the "**[OPEN]{.underline}**" button is clicked on a OneNote page,
it performs a convert action to visit a embedded page, most of the case
written on JavaScript, as mentioned on the Figure 4.

![](.//media/image9.png){width="6.5in" height="2.01875in"}

Figure 4: The triggered script will be launched

Therefore, the next action will be the dropping BAT file with a random
generated name, for example: "*522381.dat*" or "*aOQSyYHK.bat*"

![](.//media/image10.png){width="6.5in" height="0.73125in"}

Figure 5: CMD file & De-obfuscated BAT file

Upon the execution of the this PowerShell script, a ".dat" file will be
download but as JPG file using *Invoke-WebRequest* command.

The file is then saved as a JPG file in the %programdata% path. However,
the downloaded file is not an actual GIF file but a DLL Qakbot
executable file, which is subsequently run using "Rundll32.exe" with the
"Wind" parameter.

![](.//media/image11.png){width="6.5in" height="0.8743055555555556in"}

Figure 6: Process Tree

Conclusion
==========

Qakbot malware represents a clear example of the constantly evolving
threat landscape, underlining the importance of remaining vigilant in
the cybersecurity domain.

Its complex structure, extensive impact, and widespread prevalence
reinforce the need for proactive and robust security measures. The
Threat Actors responsible for Qakbot remain highly active. They
consistently adapt their methods to avoid detection and maximize their
gains, using innovative attack vectors such as OneNote attachments to
display their sophistication and ingenuity.

Recommendations
===============

We have listed some essential cybersecurity best practices that create
the first line of control against attackers. We recommend that our
readers follow the best practices given below:

-   Do not open emails from unknown or unverified senders.

-   Avoid downloading pirated software from unverified sites.

-   Use strong passwords and enforce multi-factor authentication
    wherever possible. 

-   Keep updating your passwords after certain intervals.

-   Use reputed anti-virus solutions and internet security software
    packages on your connected devices, including PCs, laptops, and
    mobile devices.  

-   Avoid opening untrusted links and email attachments without first
    verifying their authenticity.   

-   Block URLs that could use to spread the malware, e.g.,
    Torrent/Warez.  

-   Monitor the beacon on the network level to block data exfiltration
    by malware or Threat actors.  

-   Enable Data Loss Prevention (DLP) Solutions on employees' systems.

MITRE ATT&CK® Techniques
========================

![](.//media/image12.png){width="10.711805555555555in"
height="3.1145833333333335in"}

-   *PS: A .json file will be included with the report holding the
    mapped TTPs *

  -------------------------------------------------------------------------------------------------------------------------------------------
  **Tactic **                **Technique ID **                                                     **Technique Name **
  -------------------------- --------------------------------------------------------------------- ------------------------------------------
  **Initial Access **        [[T1566]{.underline}](https://attack.mitre.org/techniques/T1566)      Spearphishing Attachment

  **Execution **             [[T1204]{.underline}](https://attack.mitre.org/techniques/T1204/) \   User Execution\
                             [[T1059]{.underline}](https://attack.mitre.org/techniques/T1059)\     Command and Scripting Interpreter\
                             [[T1218]{.underline}](https://attack.mitre.org/techniques/T1218)\     Rundll32 \
                             [[T1059]{.underline}](https://attack.mitre.org/techniques/T1059)      PowerShell

  **Defense Evasion **       [[T1140]{.underline}](https://attack.mitre.org/techniques/T1140/)\    Deobfuscate/Decode Files or Information\
                             [[T1564]{.underline}](https://attack.mitre.org/techniques/T1564)\     Hidden Window\
                             [[T1055]{.underline}](https://attack.mitre.org/techniques/T1055)      Process Injection

  **Credential Access   **   [[T1555]{.underline}](https://attack.mitre.org/techniques/T1555/)\    Credentials from Password Stores   \
                             [[T1056]{.underline}](https://attack.mitre.org/techniques/T1056/)     Keylogging

  **Discovery   **           [[T1087]{.underline}](https://attack.mitre.org/techniques/T1087/)\    Account Discovery   \
                             [[T1518]{.underline}](https://attack.mitre.org/techniques/T1518/)\    Software Discovery   \
                             [[T1057]{.underline}](https://attack.mitre.org/techniques/T1057/)\    Process Discovery   \
                             [[T1007]{.underline}](https://attack.mitre.org/techniques/T1007/)     System Service Discovery   

  **Collection**             [[T1113]{.underline}](https://attack.mitre.org/techniques/T1113)\     Screen Capture\
                             [[T1115]{.underline}](https://attack.mitre.org/techniques/T1115)      Clipboard Data

  **Command and**\           [[T1071]{.underline}](https://attack.mitre.org/techniques/T1071/)\    Application Layer Protocol   \
  **Control   **             [[T1105]{.underline}](https://attack.mitre.org/techniques/T1105)      Ingress Tool Transfer
  -------------------------------------------------------------------------------------------------------------------------------------------

IOCs (Indicator of Compromise)
==============================

Here\'s a brief description of each known IOC file related to Qakbot
that could be included on a our EDR and IOC repository (ODDO BHF MISP):

1\. CVEs

This file contains a list of Common Vulnerabilities and Exposures (CVEs)
associated with Qakbot. These vulnerabilities can be used by attackers
to gain access to vulnerable systems and deploy Qakbot or other malware.

2\. EMAILs

This file contains a list of email addresses associated with Qakbot,
such as those used to send spam or phishing emails to distribute the
malware.

3\. HASHs

This file contains a list of file hashes associated with Qakbot. These
hashes can be used to identify files that are associated with the
malware and to detect and remove them from infected systems.

4\. HOSTNAMEs

This file contains a list of domain names and hostnames associated with
Qakbot. These domain names and hostnames can be used to identify
command-and-control (C2) servers used by the malware to communicate with
attackers.

5\. IPs

This file contains a list of IP addresses associated with Qakbot. These
IP addresses can be used to identify C2 servers or other systems that
are part of the Qakbot infrastructure.

6\. URLs

This file contains a list of URLs associated with Qakbot. These URLs can
be used to identify websites or web-based applications that are used to
distribute the malware or to host exploit kits used to deliver Qakbot
payloads.

IOCs will be added to internal CTI plateform.
